---
title: "–ë–æ–ª—å—à–∏–µ_–¥–∞–Ω–Ω—ã–µ_Quarto_project"
author: 
- –ê.–¶. –ñ–∞–ª—Å–∞–ø–æ–≤
format:
  html:
    code-fold: true
    toc: true
    abstract: |
      –≠—Ç–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è.
execute:
  message: false 
  warning: false
  echo: true
editor: visual
---

## –¢–µ–∫—Å—Ç: –ø—Ä–∏–º–µ—Ä —Ä–∏—Å—É–Ω–∫–∞, —Å–º. \@fig-ggplot.

```{r}
#| label: fig-ggplot
#| fig-cap: "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è `ggplot`"
library(hrbrthemes)
library(tidyverse)

ggplot(mtcars, aes(mpg, wt)) +
  geom_point(color = ft_cols$yellow) +
  geom_smooth() +
  labs(x = "–≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–ø–ª–∏–≤–∞ (mpg)", 
       y = "–í–µ—Å (—Ç)",
       title = "–ü—Ä–∏–º–µ—Ä –¥–∏–∞–≥—Ä–∞–º–º—ã —Ä–∞—Å—Å–µ—è–Ω–∏—è",
       caption = "–ò—Å—Ç–æ—á–Ω–∏–∫: hrbrthemes") + 
  theme_ft_rc()
```

# –ö–∞—Ä—Ç–∞ –ø—É–Ω–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤ –°–®–ê

–¶–µ–ª—å: —Å—Ä–∞–≤–Ω–∏—Ç—å —Å—Ä–µ–¥–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–æ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è. –î–∞–Ω–Ω—ã–µ: flights, airports –ì–µ–æ: —Ç–æ—á–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ + —Ü–≤–µ—Ç/—Ä–∞–∑–º–µ—Ä –∫—Ä—É–≥–∞ = —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: ggplot2 + geom_point() —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ lat, lon. üí° –û–±—ä–µ–¥–∏–Ω–∏—Ç–µ flights$dest —Å airports$faa –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç. 2. –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π –¶–µ–ª—å: –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å, –∫—É–¥–∞ —á–∞—â–µ –≤—Å–µ–≥–æ –ª–µ—Ç–∞–µ—Ç –∫–∞–∂–¥–∞—è –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è. –î–∞–Ω–Ω—ã–µ: flights, airlines, airports

–ì–µ–æ: –∫–∞—Ä—Ç–∞ –°–®–ê —Å –ø—É–Ω–∫—Ç–∞–º–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏.

–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏, —á—Ç–æ–±—ã –æ–±–ª–µ–≥—á–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É.

```{r}
library(nycflights23)
library(dplyr)
library(ggplot2)
library(maps)
```

```{r}
# –û—Å–Ω–æ–≤–Ω–æ–π –¥–∞—Ç–∞—Ñ—Ä–µ–π–º flights
data <- flights |> 
  # –î–æ–±–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞—ç—Ä–æ–ø–æ—Ä—Ç–µ –ø—Ä–∏–±—ã—Ç–∏—è
  left_join(airports, by = c("dest" = "faa"), suffix = c("", "_dest"))|> 
  na.omit()


# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–æ–∫ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞
head(data)


# üßÆ –®–∞–≥ 1: —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω—é—é –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
avg_delay_by_dest <- data |> 
  group_by(dest) |> 
  summarise(avg_arr_delay = mean(arr_delay, na.rm = TRUE),
            count = n()) |> 
  filter(count > 100)  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî —É–±—Ä–∞—Ç—å —Ä–µ–¥–∫–∏–µ –∞—ç—Ä–æ–ø–æ—Ä—Ç—ã
```

```{r}
# üåç –®–∞–≥ 2: –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤
airport_delays <- avg_delay_by_dest |> 
  inner_join(airports, by = c("dest" = "faa")) |> 
  filter(!is.na(lat) & !is.na(lon))
```

```{r}
# üó∫Ô∏è –®–∞–≥ 3: —Ä–∏—Å—É–µ–º –∫–∞—Ä—Ç—É —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
usa_map <- map_data("state")  # —Ñ–æ–Ω –∫–∞—Ä—Ç—ã –°–®–ê

ggplot() +
  geom_polygon(data = usa_map, aes(x = long, y = lat, group = group),
               fill = "gray95", color = "white") +
  geom_point(data = airport_delays,
             aes(x = lon, y = lat, size = avg_arr_delay, color = avg_arr_delay),
             alpha = 0.8) +
  scale_color_gradient2(low = "green", mid = "yellow", high = "red", midpoint = 15,
                        name = "‚è± –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–º–∏–Ω)") +
  scale_size(range = c(2, 10), name = "–ó–∞–¥–µ—Ä–∂–∫–∞ (—Ä–∞–∑–º–µ—Ä)") +
  theme_minimal() +
  coord_fixed(1.3) +
  labs(
    title = "üìç –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (2023)",
    subtitle = "–î–∞–Ω–Ω—ã–µ: nycflights23",
    x = "–î–æ–ª–≥–æ—Ç–∞", y = "–®–∏—Ä–æ—Ç–∞"
  )
```

```{r}
# –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Å–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏ –∏ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
top_routes <- flights %>%
  group_by(carrier, dest) %>%
  summarise(flights_count = n(), .groups = "drop")

# –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏
top_routes <- top_routes %>%
  left_join(airlines, by = "carrier") %>%
  left_join(airports, by = c("dest" = "faa")) %>%
  filter(!is.na(lat) & !is.na(lon))

# ‚úèÔ∏è –ó–ê–î–ê–ô –ò–ú–Ø –ê–í–ò–ê–ö–û–ú–ü–ê–ù–ò–ò
selected_airline <- "United Air Lines Inc."

# –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏
routes_filtered <- top_routes %>%
  filter(name.x == selected_airline & flights_count > 100)  # —É–±—Ä–∞—Ç—å —Ä–µ–¥–∫–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

# –§–æ–Ω –∫–∞—Ä—Ç—ã –°–®–ê
usa_map <- map_data("state")

# –°—Ç—Ä–æ–∏–º –∫–∞—Ä—Ç—É
ggplot() +
  geom_polygon(data = usa_map, aes(x = long, y = lat, group = group),
               fill = "gray95", color = "white") +
  geom_point(data = routes_filtered,
             aes(x = lon, y = lat, size = flights_count),
             color = "steelblue", alpha = 0.7) +
  scale_size(range = c(2, 10), name = "–ö–æ–ª-–≤–æ —Ä–µ–π—Å–æ–≤") +
  theme_minimal() +
  coord_fixed(1.3) +
  labs(
    title = paste("üõ´ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è —Ä–µ–π—Å–æ–≤ –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–∏:", selected_airline),
    subtitle = "–î–∞–Ω–Ω—ã–µ: nycflights23 (2023)",
    x = "–î–æ–ª–≥–æ—Ç–∞", y = "–®–∏—Ä–æ—Ç–∞"
  )






```




